---
title: "CNV.calling.script_NGS3_target.probes.3"
author: '*SES*'
date: "Thursday, June 19, 2014"
output: pdf_document
---

* ngs_probes3 <- read.delim("C:~/Documents/ngs_probes3.bed", header=F)
library(ExomeDepth)
### ExomeCount <- getBamCounts (bed.frame = ngs_target_3rd_set,
* bam.files = c("C:/Users/selshamieh/Documents/BAM_BAI_FILES/NGS3/unsolved_cases/CIC00011.bam", 
"C:/Users/selshamieh/Documents/BAM_BAI_FILES/NGS3/unsolved_cases/CIC00014.bam", "C:/Users/selshamieh/Documents/BAM_BAI_FILES/NGS3/unsolved_cases/CIC00126.bam", "C:/Users/selshamieh/Documents/BAM_BAI_FILES/NGS3/unsolved_cases/CIC00166.bam", "C:/Users/selshamieh/Documents/BAM_BAI_FILES/NGS3/unsolved_cases/CIC00235.bam", "C:/Users/selshamieh/Documents/BAM_BAI_FILES/NGS3/unsolved_cases/CIC00260.bam", "C:/Users/selshamieh/Documents/BAM_BAI_FILES/NGS3/unsolved_cases/CIC00554.bam", "C:/Users/selshamieh/Documents/BAM_BAI_FILES/NGS3/unsolved_cases/CIC00657.bam", "C:/Users/selshamieh/Documents/BAM_BAI_FILES/NGS3/unsolved_cases/CIC00691.bam", "C:/Users/selshamieh/Documents/BAM_BAI_FILES/NGS3/unsolved_cases/CIC00784.bam", 
"C:/Users/selshamieh/Documents/BAM_BAI_FILES/NGS3/unsolved_cases/CIC00793.bam", "C:/Users/selshamieh/Documents/BAM_BAI_FILES/NGS3/unsolved_cases/CIC00819.bam", "C:/Users/selshamieh/Documents/BAM_BAI_FILES/NGS3/unsolved_cases/CIC00858.bam", "C:/Users/selshamieh/Documents/BAM_BAI_FILES/NGS3/unsolved_cases/CIC00881.bam",  "C:/Users/selshamieh/Documents/BAM_BAI_FILES/NGS3/unsolved_cases/CIC00998.bam", "C:/Users/selshamieh/Documents/BAM_BAI_FILES/NGS3/unsolved_cases/CIC01162.bam", "C:/Users/selshamieh/Documents/BAM_BAI_FILES/NGS3/unsolved_cases/CIC01163.bam", "C:/Users/selshamieh/Documents/BAM_BAI_FILES/NGS3/unsolved_cases/CIC01188.bam", "C:/Users/selshamieh/Documents/BAM_BAI_FILES/NGS3/unsolved_cases/CIC01227.bam", "C:/Users/selshamieh/Documents/BAM_BAI_FILES/NGS3/unsolved_cases/CIC01237.bam", "C:/Users/selshamieh/Documents/BAM_BAI_FILES/NGS3/unsolved_cases/CIC01240.bam", "C:/Users/selshamieh/Documents/BAM_BAI_FILES/NGS3/unsolved_cases/CIC01273.bam", 
"C:/Users/selshamieh/Documents/BAM_BAI_FILES/NGS3/unsolved_cases/CIC01279.bam", "C:/Users/selshamieh/Documents/BAM_BAI_FILES/NGS3/unsolved_cases/CIC01293.bam", "C:/Users/selshamieh/Documents/BAM_BAI_FILES/NGS3/unsolved_cases/CIC01295.bam", 
"C:/Users/selshamieh/Documents/BAM_BAI_FILES/NGS3/unsolved_cases/CIC01322.bam", "C:/Users/selshamieh/Documents/BAM_BAI_FILES/NGS3/unsolved_cases/CIC01355.bam", "C:/Users/selshamieh/Documents/BAM_BAI_FILES/NGS3/unsolved_cases/CIC01357.bam", "C:/Users/selshamieh/Documents/BAM_BAI_FILES/NGS3/unsolved_cases/CIC01399.bam", "C:/Users/selshamieh/Documents/BAM_BAI_FILES/NGS3/unsolved_cases/CIC01420.bam", "C:/Users/selshamieh/Documents/BAM_BAI_FILES/NGS3/unsolved_cases/CIC01438.bam", "C:/Users/selshamieh/Documents/BAM_BAI_FILES/NGS3/unsolved_cases/CIC01611.bam", "C:/Users/selshamieh/Documents/BAM_BAI_FILES/NGS3/unsolved_cases/CIC01960.bam", "C:/Users/selshamieh/Documents/BAM_BAI_FILES/NGS3/unsolved_cases/CIC02540.bam", "C:/Users/selshamieh/Documents/BAM_BAI_FILES/NGS3/unsolved_cases/CIC02579.bam", "C:/Users/selshamieh/Documents/BAM_BAI_FILES/NGS3/unsolved_cases/CIC02631.bam", "C:/Users/selshamieh/Documents/BAM_BAI_FILES/NGS3/unsolved_cases/CIC02676.bam", "C:/Users/selshamieh/Documents/BAM_BAI_FILES/NGS3/unsolved_cases/CIC02692.bam", "C:/Users/selshamieh/Documents/BAM_BAI_FILES/NGS3/unsolved_cases/CIC02711.bam", "C:/Users/selshamieh/Documents/BAM_BAI_FILES/NGS3/unsolved_cases/CIC02712.bam", "C:/Users/selshamieh/Documents/BAM_BAI_FILES/NGS3/unsolved_cases/CIC02713.bam", "C:/Users/selshamieh/Documents/BAM_BAI_FILES/NGS3/unsolved_cases/CIC02866.bam", "C:/Users/selshamieh/Documents/BAM_BAI_FILES/NGS3/unsolved_cases/CIC02886.bam", "C:/Users/selshamieh/Documents/BAM_BAI_FILES/NGS3/unsolved_cases/CIC02901.bam", "C:/Users/selshamieh/Documents/BAM_BAI_FILES/NGS3/unsolved_cases/CIC02923.bam", "C:/Users/selshamieh/Documents/BAM_BAI_FILES/NGS3/unsolved_cases/CIC02952.bam", "C:/Users/selshamieh/Documents/BAM_BAI_FILES/NGS3/unsolved_cases/CIC03038.bam", "C:/Users/selshamieh/Documents/BAM_BAI_FILES/NGS3/unsolved_cases/CIC03404.bam", "C:/Users/selshamieh/Documents/BAM_BAI_FILES/NGS3/unsolved_cases/CIC03645.bam", "C:/Users/selshamieh/Documents/BAM_BAI_FILES/NGS3/unsolved_cases/CIC04437.bam", "C:/Users/selshamieh/Documents/BAM_BAI_FILES/NGS3/unsolved_cases/CIC04489.bam",
"C:/Users/selshamieh/Documents/BAM_BAI_FILES/NGS3/unsolved_cases/CIC04875.bam", "C:/Users/selshamieh/Documents/BAM_BAI_FILES/NGS3/unsolved_cases/CIC04914.bam", "C:/Users/selshamieh/Documents/BAM_BAI_FILES/NGS3/unsolved_cases/CIC06128.bam", "C:/Users/selshamieh/Documents/BAM_BAI_FILES/NGS3/unsolved_cases/CIC06660.bam", "C:/Users/selshamieh/Documents/BAM_BAI_FILES/NGS3/unsolved_cases/CIC06989.bam", "C:/Users/selshamieh/Documents/BAM_BAI_FILES/NGS3/solved_cases/CIC00041.bam", "C:/Users/selshamieh/Documents/BAM_BAI_FILES/NGS3/solved_cases/CIC00078.bam", "C:/Users/selshamieh/Documents/BAM_BAI_FILES/NGS3/solved_cases/CIC00082.bam", "C:/Users/selshamieh/Documents/BAM_BAI_FILES/NGS3/solved_cases/CIC00214.bam", "C:/Users/selshamieh/Documents/BAM_BAI_FILES/NGS3/solved_cases/CIC00447.bam", "C:/Users/selshamieh/Documents/BAM_BAI_FILES/NGS3/solved_cases/CIC00456.bam", "C:/Users/selshamieh/Documents/BAM_BAI_FILES/NGS3/solved_cases/CIC00458.bam", "C:/Users/selshamieh/Documents/BAM_BAI_FILES/NGS3/solved_cases/CIC00584.bam", "C:/Users/selshamieh/Documents/BAM_BAI_FILES/NGS3/solved_cases/CIC00790.bam", "C:/Users/selshamieh/Documents/BAM_BAI_FILES/NGS3/solved_cases/CIC00924.bam", "C:/Users/selshamieh/Documents/BAM_BAI_FILES/NGS3/solved_cases/CIC01313.bam", "C:/Users/selshamieh/Documents/BAM_BAI_FILES/NGS3/solved_cases/CIC01553.bam",
"C:/Users/selshamieh/Documents/BAM_BAI_FILES/NGS3/solved_cases/CIC01071.bam", "C:/Users/selshamieh/Documents/BAM_BAI_FILES/NGS3/solved_cases/CIC01101.bam", "C:/Users/selshamieh/Documents/BAM_BAI_FILES/NGS3/solved_cases/CIC01302.bam", "C:/Users/selshamieh/Documents/BAM_BAI_FILES/NGS3/solved_cases/CIC02832.bam", "C:/Users/selshamieh/Documents/BAM_BAI_FILES/NGS3/solved_cases/CIC02948.bam", "C:/Users/selshamieh/Documents/BAM_BAI_FILES/NGS3/solved_cases/CIC05880.bam",
"C:/Users/selshamieh/Documents/BAM_BAI_FILES/NGS3/solved_cases/CIC06503.bam"),
include.chr = TRUE)
* my.test <- c('CIC00011.bam', 'CIC00014.bam', 'CIC00126.bam', 'CIC00166.bam', 'CIC00235.bam', 'CIC00260.bam', 'CIC00554.bam', 'CIC00657.bam', 'CIC00691.bam', 'CIC00784.bam', 'CIC00793.bam', 'CIC00819.bam', 'CIC00858.bam', 'CIC00881.bam',  'CIC00998.bam', 'CIC01162.bam', 'CIC01163.bam', 'CIC01188.bam', 'CIC01227.bam', 'CIC01237.bam', 'CIC01240.bam', 'CIC01273.bam', 'CIC01279.bam', 'CIC01293.bam', 'CIC01295.bam', 'CIC01322.bam', 'CIC01355.bam', 'CIC01357.bam', 'CIC01399.bam', 'CIC01420.bam', 'CIC01438.bam', 'CIC01611.bam', 'CIC01960.bam', 'CIC02540.bam', 'CIC02579.bam', 'CIC02631.bam', 'CIC02676.bam', 'CIC02692.bam', 'CIC02711.bam', 'CIC02712.bam', 'CIC02713.bam', 'CIC02866.bam', 'CIC02886.bam', 'CIC02901.bam', 'CIC02923.bam', 'CIC02952.bam', 'CIC03038.bam', 'CIC03404.bam', 'CIC03645.bam', 'CIC04437.bam', 'CIC04489.bam','CIC04875.bam', 'CIC04914.bam', 'CIC06128.bam', 'CIC06660.bam', 'CIC06989.bam')
* my.ref.samples <- c('CIC00041.bam', 'CIC00078.bam', 'CIC00082.bam', 'CIC00214.bam', 'CIC00447.bam', 'CIC00456.bam', 'CIC00458.bam', 'CIC00584.bam', 'CIC00790.bam', 'CIC00924.bam', 'CIC01313.bam', 'CIC01553.bam', 'CIC01071.bam', 'CIC01101.bam', 'CIC01302.bam', 'CIC02832.bam', 'CIC02948.bam', 'CIC05880.bam', 'CIC06503.bam') 
## my.reference.set <- as.matrix(ExomeCount.ngs3[, my.ref.samples])
## my.test.set <- as.matrix(ExomeCount.ngs3[,my.test])
* for (i in 1:dim(my.test.set)) {
        sample_name = colnames(my.test.set)[i]
        reference_list = select.reference.set(test.counts = my.test.set[,i],
        reference.count = my.reference.set,
        bin.length=(ExomeCount.ngs3$end-ExomeCount.ngs3$start)/1000,
        n.bins.reduced = 10000)
* reference_set = apply(
        X = as.matrix(ExomeCount.ngs3[, reference_list$reference.choice]),
        MAR=1, FUN=sum)
* all_exons = new('ExomeDepth', test=my.test.set[,i],
        reference=reference_set,
        formula = 'cbind(test,reference) ~ 1')
* all_exons = CallCNVs(x = all_exons, transition.probability=10^-4,
        chromosome=ExomeCount.ngs3$space, start=ExomeCount.ngs3$start,
        end=ExomeCount.ngs3$end, name=ExomeCount.ngs3$name)
* write.table(all_exons@CNV.calls, file=paste(sample_name,".txt",sep=''),
        sep='\t', row.names=FALSE, col.names=TRUE, quote=FALSE)
}